{"version":3,"file":"mainareawidget.js","sourceRoot":"","sources":["../../../../apputils/src/mainareawidget.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright (c) Jupyter Development Team.\n// Distributed under the terms of the Modified BSD License.\n\nimport { UUID } from '@phosphor/coreutils';\n\nimport { Message } from '@phosphor/messaging';\n\nimport { BoxLayout, Widget } from '@phosphor/widgets';\n\nimport { Spinner } from './spinner';\n\nimport { Toolbar } from './toolbar';\n\n/**\n * A widget meant to be contained in the JupyterLab main area.\n *\n * #### Notes\n * Mirrors all of the `title` attributes of the content.\n * This widget is `closable` by default.\n * This widget is automatically disposed when closed.\n * This widget ensures its own focus when activated.\n */\nexport class MainAreaWidget<T extends Widget = Widget> extends Widget {\n  /**\n   * Construct a new main area widget.\n   *\n   * @param options - The options for initializing the widget.\n   */\n  constructor(options: MainAreaWidget.IOptions<T>) {\n    super(options);\n    this.addClass('jp-MainAreaWidget');\n    this.id = UUID.uuid4();\n\n    const content = (this._content = options.content);\n    const toolbar = (this._toolbar = options.toolbar || new Toolbar());\n    const spinner = this._spinner;\n\n    const layout = (this.layout = new BoxLayout({ spacing: 0 }));\n    layout.direction = 'top-to-bottom';\n    BoxLayout.setStretch(toolbar, 0);\n    BoxLayout.setStretch(content, 1);\n    layout.addWidget(toolbar);\n    layout.addWidget(content);\n\n    if (!content.id) {\n      content.id = UUID.uuid4();\n    }\n    content.node.tabIndex = -1;\n\n    this._updateTitle();\n    content.title.changed.connect(this._updateTitle, this);\n    this.title.closable = true;\n    this.title.changed.connect(this._updateContentTitle, this);\n\n    if (options.reveal) {\n      this.node.appendChild(spinner.node);\n      this._revealed = options.reveal\n        .then(() => {\n          if (content.isDisposed) {\n            this.dispose();\n            return;\n          }\n          content.disposed.connect(() => this.dispose());\n          const active = document.activeElement === spinner.node;\n          this.node.removeChild(spinner.node);\n          spinner.dispose();\n          this._isRevealed = true;\n          if (active) {\n            this._focusContent();\n          }\n        })\n        .catch(e => {\n          // Show a revealed promise error.\n          const error = new Widget();\n          // Show the error to the user.\n          const pre = document.createElement('pre');\n          pre.textContent = String(e);\n          error.node.appendChild(pre);\n          BoxLayout.setStretch(error, 1);\n          this.node.removeChild(spinner.node);\n          spinner.dispose();\n          content.dispose();\n          this._content = null;\n          toolbar.dispose();\n          this._toolbar = null;\n          layout.addWidget(error);\n          this._isRevealed = true;\n          throw error;\n        });\n    } else {\n      // Handle no reveal promise.\n      spinner.dispose();\n      content.disposed.connect(() => this.dispose());\n      this._isRevealed = true;\n      this._revealed = Promise.resolve(undefined);\n    }\n  }\n\n  /**\n   * The content hosted by the widget.\n   */\n  get content(): T {\n    return this._content;\n  }\n\n  /**\n   * The toolbar hosted by the widget.\n   */\n  get toolbar(): Toolbar {\n    return this._toolbar;\n  }\n\n  /**\n   * Whether the content widget or an error is revealed.\n   */\n  get isRevealed(): boolean {\n    return this._isRevealed;\n  }\n\n  /**\n   * A promise that resolves when the widget is revealed.\n   */\n  get revealed(): Promise<void> {\n    return this._revealed;\n  }\n\n  /**\n   * Handle the DOM events for the widget.\n   *\n   * @param event - The DOM event sent to the widget.\n   *\n   * #### Notes\n   * This method implements the DOM `EventListener` interface and is\n   * called in response to events on the main area widget's node. It should\n   * not be called directly by user code.\n   */\n  handleEvent(event: Event): void {\n    switch (event.type) {\n      case 'mouseup':\n      case 'mouseout':\n        let target = event.target as HTMLElement;\n        if (\n          this._isRevealed &&\n          this._content &&\n          this.toolbar.node.contains(document.activeElement) &&\n          target.tagName !== 'SELECT'\n        ) {\n          this._focusContent();\n        }\n        break;\n      default:\n        break;\n    }\n  }\n\n  /**\n   * Handle `after-attach` messages for the widget.\n   */\n  protected onAfterAttach(msg: Message): void {\n    this.toolbar.node.addEventListener('mouseup', this);\n    this.toolbar.node.addEventListener('mouseout', this);\n  }\n\n  /**\n   * Handle `before-detach` messages for the widget.\n   */\n  protected onBeforeDetach(msg: Message): void {\n    this.toolbar.node.removeEventListener('mouseup', this);\n    this.toolbar.node.removeEventListener('mouseout', this);\n  }\n\n  /**\n   * Handle `'activate-request'` messages.\n   */\n  protected onActivateRequest(msg: Message): void {\n    if (this._isRevealed) {\n      if (this._content) {\n        this._focusContent();\n      }\n    } else {\n      this._spinner.node.focus();\n    }\n  }\n\n  /**\n   * Handle `'close-request'` messages.\n   */\n  protected onCloseRequest(msg: Message): void {\n    this.dispose();\n  }\n\n  /**\n   * Update the title based on the attributes of the child widget.\n   */\n  private _updateTitle(): void {\n    if (this._changeGuard) {\n      return;\n    }\n    this._changeGuard = true;\n    const content = this.content;\n    this.title.label = content.title.label;\n    this.title.mnemonic = content.title.mnemonic;\n    this.title.iconClass = content.title.iconClass;\n    this.title.iconLabel = content.title.iconLabel;\n    this.title.caption = content.title.caption;\n    this.title.className = content.title.className;\n    this.title.dataset = content.title.dataset;\n    this._changeGuard = false;\n  }\n\n  /**\n   * Update the content title based on attributes of the main widget.\n   */\n  private _updateContentTitle(): void {\n    if (this._changeGuard) {\n      return;\n    }\n    this._changeGuard = true;\n    const content = this.content;\n    content.title.label = this.title.label;\n    content.title.mnemonic = this.title.mnemonic;\n    content.title.iconClass = this.title.iconClass;\n    content.title.iconLabel = this.title.iconLabel;\n    content.title.caption = this.title.caption;\n    content.title.className = this.title.className;\n    content.title.dataset = this.title.dataset;\n    this._changeGuard = false;\n  }\n\n  /**\n   * Give focus to the content.\n   */\n  private _focusContent(): void {\n    // Focus the content node if we aren't already focused on it or a\n    // descendent.\n    if (!this.content.node.contains(document.activeElement)) {\n      this.content.node.focus();\n    }\n\n    // Activate the content asynchronously (which may change the focus).\n    this.content.activate();\n  }\n\n  private _content: T;\n  private _toolbar: Toolbar;\n  private _changeGuard = false;\n  private _spinner = new Spinner();\n\n  private _isRevealed = false;\n  private _revealed: Promise<void>;\n}\n\n/**\n * The namespace for the `MainAreaWidget` class statics.\n */\nexport namespace MainAreaWidget {\n  /**\n   * An options object for creating a main area widget.\n   */\n  export interface IOptions<T extends Widget = Widget> extends Widget.IOptions {\n    /**\n     * The child widget to wrap.\n     */\n    content: T;\n\n    /**\n     * The toolbar to use for the widget.  Defaults to an empty toolbar.\n     */\n    toolbar?: Toolbar;\n\n    /**\n     * An optional promise for when the content is ready to be revealed.\n     */\n    reveal?: Promise<any>;\n  }\n\n  /**\n   * An options object for main area widget subclasses providing their own\n   * default content.\n   *\n   * #### Notes\n   * This makes it easier to have a subclass that provides its own default\n   * content. This can go away once we upgrade to TypeScript 2.8 and have an\n   * easy way to make a single property optional, ala\n   * https://stackoverflow.com/a/46941824\n   */\n  export interface IOptionsOptionalContent<T extends Widget = Widget>\n    extends Widget.IOptions {\n    /**\n     * The child widget to wrap.\n     */\n    content?: T;\n\n    /**\n     * The toolbar to use for the widget.  Defaults to an empty toolbar.\n     */\n    toolbar?: Toolbar;\n\n    /**\n     * An optional promise for when the content is ready to be revealed.\n     */\n    reveal?: Promise<any>;\n  }\n}\n"]}