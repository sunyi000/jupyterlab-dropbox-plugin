{"version":3,"file":"browser.js","sourceRoot":"","sources":["../../../../filebrowser/src/browser.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright (c) Jupyter Development Team.\n// Distributed under the terms of the Modified BSD License.\n\nimport { showErrorMessage, Toolbar, ToolbarButton } from '@jupyterlab/apputils';\n\nimport { DocumentManager } from '@jupyterlab/docmanager';\n\nimport { Contents, ServerConnection } from '@jupyterlab/services';\n\nimport { IIterator } from '@phosphor/algorithm';\n\nimport { CommandRegistry } from '@phosphor/commands';\n\nimport { PanelLayout, Widget } from '@phosphor/widgets';\n\nimport { BreadCrumbs } from './crumbs';\n\nimport { DirListing } from './listing';\n\nimport { FileBrowserModel } from './model';\n\nimport { Uploader } from './upload';\n\n/**\n * The class name added to file browsers.\n */\nconst FILE_BROWSER_CLASS = 'jp-FileBrowser';\n\n/**\n * The class name added to the filebrowser crumbs node.\n */\nconst CRUMBS_CLASS = 'jp-FileBrowser-crumbs';\n\n/**\n * The class name added to the filebrowser toolbar node.\n */\nconst TOOLBAR_CLASS = 'jp-FileBrowser-toolbar';\n\n/**\n * The class name added to the filebrowser listing node.\n */\nconst LISTING_CLASS = 'jp-FileBrowser-listing';\n\n/**\n * A widget which hosts a file browser.\n *\n * The widget uses the Jupyter Contents API to retrieve contents,\n * and presents itself as a flat list of files and directories with\n * breadcrumbs.\n */\nexport class FileBrowser extends Widget {\n  /**\n   * Construct a new file browser.\n   *\n   * @param model - The file browser view model.\n   */\n  constructor(options: FileBrowser.IOptions) {\n    super();\n    this.addClass(FILE_BROWSER_CLASS);\n    this.id = options.id;\n\n    const model = (this.model = options.model);\n    const renderer = options.renderer;\n\n    model.connectionFailure.connect(this._onConnectionFailure, this);\n    this._manager = model.manager;\n    this._crumbs = new BreadCrumbs({ model });\n    this.toolbar = new Toolbar<Widget>();\n\n    let directoryPending = false;\n    let newFolder = new ToolbarButton({\n      iconClassName: 'jp-NewFolderIcon jp-Icon jp-Icon-16',\n      onClick: () => {\n        if (directoryPending === true) {\n          return;\n        }\n        directoryPending = true;\n        this._manager\n          .newUntitled({\n            path: model.path,\n            type: 'directory'\n          })\n          .then(model => {\n            this._listing.selectItemByName(model.name);\n            directoryPending = false;\n          })\n          .catch(err => {\n            directoryPending = false;\n          });\n      },\n      tooltip: 'New Folder'\n    });\n\n    let uploader = new Uploader({ model });\n\n    let refresher = new ToolbarButton({\n      iconClassName: 'jp-RefreshIcon jp-Icon jp-Icon-16',\n      onClick: () => {\n        model.refresh();\n      },\n      tooltip: 'Refresh File List'\n    });\n\n    this.toolbar.addItem('newFolder', newFolder);\n    this.toolbar.addItem('upload', uploader);\n    this.toolbar.addItem('refresher', refresher);\n\n    this._listing = new DirListing({ model, renderer });\n\n    this._crumbs.addClass(CRUMBS_CLASS);\n    this.toolbar.addClass(TOOLBAR_CLASS);\n    this._listing.addClass(LISTING_CLASS);\n\n    let layout = new PanelLayout();\n    layout.addWidget(this.toolbar);\n    layout.addWidget(this._crumbs);\n    layout.addWidget(this._listing);\n\n    this.layout = layout;\n    model.restore(this.id);\n  }\n\n  /**\n   * The model used by the file browser.\n   */\n  readonly model: FileBrowserModel;\n\n  /**\n   * The toolbar used by the file browser.\n   */\n  readonly toolbar: Toolbar<Widget>;\n\n  /**\n   * Create an iterator over the listing's selected items.\n   *\n   * @returns A new iterator over the listing's selected items.\n   */\n  selectedItems(): IIterator<Contents.IModel> {\n    return this._listing.selectedItems();\n  }\n\n  /**\n   * Rename the first currently selected item.\n   *\n   * @returns A promise that resolves with the new name of the item.\n   */\n  rename(): Promise<string> {\n    return this._listing.rename();\n  }\n\n  /**\n   * Cut the selected items.\n   */\n  cut(): void {\n    this._listing.cut();\n  }\n\n  /**\n   * Copy the selected items.\n   */\n  copy(): void {\n    this._listing.copy();\n  }\n\n  /**\n   * Paste the items from the clipboard.\n   *\n   * @returns A promise that resolves when the operation is complete.\n   */\n  paste(): Promise<void> {\n    return this._listing.paste();\n  }\n\n  /**\n   * Delete the currently selected item(s).\n   *\n   * @returns A promise that resolves when the operation is complete.\n   */\n  delete(): Promise<void> {\n    return this._listing.delete();\n  }\n\n  /**\n   * Duplicate the currently selected item(s).\n   *\n   * @returns A promise that resolves when the operation is complete.\n   */\n  duplicate(): Promise<void> {\n    return this._listing.duplicate();\n  }\n\n  /**\n   * Download the currently selected item(s).\n   */\n  download(): void {\n    this._listing.download();\n  }\n\n  /**\n   * Shut down kernels on the applicable currently selected items.\n   *\n   * @returns A promise that resolves when the operation is complete.\n   */\n  shutdownKernels(): Promise<void> {\n    return this._listing.shutdownKernels();\n  }\n\n  /**\n   * Select next item.\n   */\n  selectNext(): void {\n    this._listing.selectNext();\n  }\n\n  /**\n   * Select previous item.\n   */\n  selectPrevious(): void {\n    this._listing.selectPrevious();\n  }\n\n  /**\n   * Find a model given a click.\n   *\n   * @param event - The mouse event.\n   *\n   * @returns The model for the selected file.\n   */\n  modelForClick(event: MouseEvent): Contents.IModel | undefined {\n    return this._listing.modelForClick(event);\n  }\n\n  /**\n   * Handle a connection lost signal from the model.\n   */\n  private _onConnectionFailure(sender: FileBrowserModel, args: Error): void {\n    if (this._showingError) {\n      return;\n    }\n    this._showingError = true;\n\n    let title = 'Server Connection Error';\n    let networkMsg =\n      'A connection to the Jupyter server could not be established.\\n' +\n      'JupyterLab will continue trying to reconnect.\\n' +\n      'Check your network connection or Jupyter server configuration.\\n';\n\n    // Check for a fetch error.\n    if (args instanceof ServerConnection.NetworkError) {\n      args.message = networkMsg;\n    } else if (args instanceof ServerConnection.ResponseError) {\n      if (args.response.status === 404) {\n        title = 'Directory not found';\n        args.message = `Directory not found: \"${this.model.path}\"`;\n      }\n    }\n\n    showErrorMessage(title, args).then(() => {\n      this._showingError = false;\n    });\n  }\n\n  private _crumbs: BreadCrumbs;\n  private _listing: DirListing;\n  private _manager: DocumentManager;\n  private _showingError = false;\n}\n\n/**\n * The namespace for the `FileBrowser` class statics.\n */\nexport namespace FileBrowser {\n  /**\n   * An options object for initializing a file browser widget.\n   */\n  export interface IOptions {\n    /**\n     * The command registry for use with the file browser.\n     */\n    commands: CommandRegistry;\n\n    /**\n     * The widget/DOM id of the file browser.\n     */\n    id: string;\n\n    /**\n     * A file browser model instance.\n     */\n    model: FileBrowserModel;\n\n    /**\n     * An optional renderer for the directory listing area.\n     *\n     * The default is a shared instance of `DirListing.Renderer`.\n     */\n    renderer?: DirListing.IRenderer;\n  }\n}\n"]}